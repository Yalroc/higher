<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://code.getmdl.io/1.2.0/material.indigo-pink.min.css">

<!-- Second navbar -->
<div class="second-navbar-job-applications">

    <div class="navbar-higher-brand-recruiter2">
    <%= image_tag "LOreal_black_vector.png" %>
    </div>
    <div class="job-offer-title-job-applications"><%= @job_offer.title %></div>
    <%= form_tag batch_deletion_job_offer_job_applications_path, method: :delete do %>
      <%= hidden_field_tag :job_application_ids %>
      <button class="mdl-button mdl-js-button mdl-button--raised delete-but">Delete</button>
    <% end %>
</div>

<!-- Side bar -->
<div class="menu-job-applications">
  <div class="menu-header">
    <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored text-center" id="padding-button">Filters</button>
    <div class="menu-header-text">
      <strong><p>All (<%= @job_applications.where(rejected: nil).length %>)</p></strong>
      <p>Contacted (0)</p>
      <p>New (0)</p>
      <%= link_to "Messages", conversation_job_offer_job_application_path(@job_offer, @job_applications.first), class: "" %>
    </div>
  </div>
  <div class="menu-profils">
      <% current_recruiter.organization.recruiters.each do |recruiter| %>
    <div class="mini-menu-profils">
      <%= recruiter.title %><br>
      <% if recruiter == current_recruiter %>
        <i class="fa fa-circle green-point" aria-hidden="true"></i>
      <% else %>
        <i class="fa fa-circle red-point" aria-hidden="true"></i>
      <% end %>
        <i class="fa fa-comment-o text-center" aria-hidden="true"></i>
    </div>
      <% end %>
  </div>
</div>

<!-- Table -->
<div class="wrapper-table-job-offer text-center ">
  <div>
    <div class="table-applications-wrapper">
      <table class="mdl-data-table mdl-js-data-table mdl-data-table--selectable width-95-percent ">
        <thead>
          <tr>
            <th></th>
            <th class="mdl-data-table__cell--non-numeric">Candidate</th>
            <th>Fit</th>
            <th>XP</th>
            <th>Companies</th>
            <th>Education</th>
            <th>Languages</th>
            <th>Date</th>
          </tr>
        </thead>
        <tbody class="font-size-table">
          <% @job_applications.each_with_index do |job_application, y| %>
            <% unless job_application.rejected == true %>
            <tr>
              <td><span class="job-application-id" data-id="<%= job_application.id %>"><%= y + 1 %></span></td>
              <!-- Triple condition : 1. Was the profil viewed ? 2.Was the profil contacted ? 3. Has the profil an experience ?-->
                <% if job_application.viewed? != true  %>
                  <% if job_application.experiences.first == nil %>
                    <td class="text-center">-</td>
                  <% else %>
                    <% if job_application.contact == true %>
                      <td class="mdl-data-table__cell--non-numeric link-row"><%= link_to job_offer_job_application_path(@job_offer, job_application), class:"link-candidate" do %><strong><%= job_application.candidate.first_name %> <%= job_application.candidate.last_name %></strong><% end %><i class="fa fa-phone color-icon-phone" id="tool-number" aria-hidden="true"></i><i class="fa fa-envelope-o color-icon-mail" aria-hidden="true"></i><div class="font-weight-experiences-under-name link-candidate"><i><%= job_application.experiences.first.title %></i> @ <%= job_application.experiences.first.organization %></div></td>
                    <% else %>
                      <td class="mdl-data-table__cell--non-numeric link-row"><%= link_to job_offer_job_application_path(@job_offer, job_application), class:"link-candidate" do %><strong><%= job_application.experiences.first.title %> @ <%= job_application.experiences.first.organization %></strong><% end %></td>
                    <% end %>
                  <% end %>
                <% else %>
                  <% if job_application.experiences.first == nil %>
                    <% if job_application.contact == true %>
                      <td class="text-center">-<i class="fa fa-envelope-o color-icons" aria-hidden="true"></i></td>
                    <% else %>
                      <td class="text-center">-</td>
                    <% end %>
                  <% else %>
                   <% if job_application.contact == true %>
                      <td class="mdl-data-table__cell--non-numeric"><%= link_to job_offer_job_application_path(@job_offer, job_application), class:"link-candidate" do %><%= job_application.candidate.first_name %> <%= job_application.candidate.last_name %><% end %><i class="fa fa-phone color-icon-phone" id="tool-number" aria-hidden="true"></i><i class="fa fa-envelope-o color-icon-mail" aria-hidden="true"></i><div class="font-weight-experiences-under-name link-candidate"><i><%= job_application.experiences.first.title %></i> @ <%= job_application.experiences.first.organization %></div></td>

                    <!-- Modal phone number -->
                      <div class="mdl-tooltip mdl-tooltip--large" id="tooltip" for="tool-number"><%= job_application.candidate.phone_number %></div>
                    <!-- -->
                   <% else %>
                      <td class="mdl-data-table__cell--non-numeric"><%= link_to job_offer_job_application_path(@job_offer, job_application), class:"link-candidate" do %><%= job_application.experiences.first.title %> @ <%= job_application.experiences.first.organization %><% end %></td>
                  <% end %>
                <% end %>
              <% end %>


              <td class="mdl-data-table__cell--non-numeric">86.7%</td>
              <td>5y +</td>

                <!-- Organization -->

                  <% if job_application.experiences.empty? %>
                    <td>-</td>
                  <% else %>
                  <% job_application.experiences.each do |experience| %>
                    <td><%= experience.organization %></td>
                    <% end %>
                  <% end %>

                <!--  Education  -->
                  <% if job_application.educations.first.nil? %>
                    <td>-</td>
                  <% else %>
                    <td><%= job_application.educations.first.organization %></td>
                  <% end %>

                <!-- Language -->

                      <% if job_application.languages.first.nil? %>
                        <td>-</td>
                      <% else %>
                      <td>
                        <% job_application.languages.each do |language| %>
                        <%= language.name %>
                      <% end %>
                    <% end %>
                    </td>

                <!-- Date -->
                <td>
                  <% date = ((Time.now - job_application.created_at) / (24 * 60 * 60)).to_i %>
                  <% if date <= 1 %>
                  <% date = "Today"%>
                  <% else %>
                  <% date = "#{((Time.now - job_application.created_at) / (24 * 60 * 60)).to_i} ago" %>
                  <% end %>
                  <%= date %>
                  <div>(<%= job_application.created_at.strftime('%x') %>)</div>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>
   </div>
</div>

<!-- Modal to show the profil -->
<div class="modal">

</div>

<% content_for :after_js do %>
  <script>
  window.onload = function(){
    $('.wrapper-table-job-offer .mdl-checkbox__input').click(function(){
      var row = $(this).parents('tr');
      var id = $(row).find('.job-application-id').data('id');
      var checked_for_deletion = $(this).prop('checked');

      if (checked_for_deletion) {
        var hidden_field = $("#job_application_ids");
        var new_value = $(hidden_field).val() + "," + id;
        $(hidden_field).val(new_value);
      }
    });
  }
  </script>
<% end %>








